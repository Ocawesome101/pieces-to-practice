#!/usr/bin/env lua

local assignments = ""
local practiced = ""
local blacklist = {}
local ptp = io.popen("./ptp list practiced")

for assignment in ptp:lines("l") do
  local id, name = assignment:match("^(%d+) *(.+)$")
  blacklist[id] = true
  practiced = practiced .. string.format(
    "<a href='/practice?id=%s'>%s</a><br>\n", id, name)
end

ptp:close()

ptp = io.popen("./ptp list all", "r")

for assignment in ptp:lines("l") do
  local id, name = assignment:match("^(%d+) *(.+)$")
  if not blacklist[id] then
    assignments = assignments .. string.format(
      "<a href='/practice?id=%s'>%s</a><br>\n", id, name)
  end
end

ptp:close()

print(string.format([[
<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="https://ulos.pickardayune.com/ulos/style.css">

<html>
  <body>
    <p class="brightwhite">Pieces to Practice Webiface</p>
    <p>Current assignments:</p>
    <p>%s</p>
    <p>Practiced assignments:</p>
    <p class="brightwhite">Name, Time, Rating<br>
    %s</p>
  </body>
</html>
]], assignments or "", practiced or ""))
